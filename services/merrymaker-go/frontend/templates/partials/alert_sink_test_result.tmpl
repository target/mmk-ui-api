{{define "alert-sink-test-result"}}
<div class="card mt-4" id="test-fire-result">
    {{with .Result}}
    <div class="card-body">
        {{/* Status indicator using status-badge pattern from source_test_status.tmpl */}}
        <div class="mb-3">
            <div class="flex-center gap-2" style="flex-wrap:wrap;">
                {{if .Success}}
                <span class="status-badge status-badge--completed">
                    <i data-lucide="check-circle" class="w-3 h-3"></i>
                    Test Successful
                </span>
                {{else}}
                <span class="status-badge status-badge--failed">
                    <i data-lucide="x-circle" class="w-3 h-3"></i>
                    Test Failed
                </span>
                {{end}}
                {{if .DurationMs}}
                <span class="small text-muted">{{.DurationMs}}ms</span>
                {{end}}
            </div>
        </div>

        {{/* Primary test data using data-list pattern */}}
        <dl class="data-list">
            <div class="data-item">
                <dt>Status Code</dt>
                <dd>
                    {{if .StatusCode}}
                    <code class="{{if .Success}}text-success{{else}}text-danger{{end}}">{{.StatusCode}}</code>
                    {{if .ExpectedCode}}
                    <span class="small text-muted">(expected: {{.ExpectedCode}})</span>
                    {{end}}
                    {{else}}
                    <span class="text-muted">N/A</span>
                    {{end}}
                </dd>
            </div>
        </dl>

        {{/* Error message with alert pattern matching source_test_status.tmpl */}}
        {{if .ErrorMessage}}
        <div class="mt-3"
             style="display:flex;
                    align-items:flex-start;
                    gap:var(--space-2);
                    padding:var(--space-3);
                    background:var(--color-danger-bg);
                    border-left:3px solid var(--color-danger);
                    border-radius:var(--border-radius-sm)">
            <i data-lucide="alert-circle"
               class="w-3 h-3"
               style="flex-shrink:0;
                      margin-top:2px"></i>
            <span class="small" style="color:var(--color-danger-text);word-break:break-word">{{.ErrorMessage}}</span>
        </div>
        {{end}}

        {{/* Request details - collapsible */}}
        {{with .Request}}
        <details class="mt-3">
            <summary style="cursor:pointer;
                           color:var(--color-text-secondary);
                           font-size:var(--font-size-sm);
                           font-weight:var(--font-weight-medium);
                           padding:var(--space-2) 0;
                           list-style:none;
                           display:flex;
                           align-items:center;
                           gap:var(--space-2)">
                <i data-lucide="chevron-right" class="w-3 h-3" style="transition:transform 0.2s"></i>
                Request Details
            </summary>
            <div style="margin-top:var(--space-2);
                       padding:var(--space-3);
                       background:var(--color-surface-secondary);
                       border-radius:var(--border-radius-md);
                       border:var(--border-width) solid var(--color-border)">
                <dl class="data-list data-list--stacked">
                    <div class="data-item">
                        <dt>Method</dt>
                        <dd><code>{{.Method}}</code></dd>
                    </div>
                    <div class="data-item">
                        <dt>URL</dt>
                        <dd style="word-break:break-all;overflow-wrap:anywhere"><code class="mono">{{.URL}}</code></dd>
                    </div>
                    {{if .Headers}}
                    <div class="data-item">
                        <dt>Headers</dt>
                        <dd>
                            <div class="mono small" style="display:flex;flex-direction:column;gap:var(--space-1)">
                                {{range $k, $v := .Headers}}
                                <div style="word-break:break-all;overflow-wrap:anywhere"><strong>{{$k}}:</strong> {{$v}}</div>
                                {{end}}
                            </div>
                        </dd>
                    </div>
                    {{end}}
                    {{if .Body}}
                    <div class="data-item">
                        <dt>Body{{if .BodyTruncated}} <span class="text-muted">(truncated)</span>{{end}}</dt>
                        <dd>
                            <pre class="code-block" style="max-height:300px;overflow:auto">{{.Body}}</pre>
                        </dd>
                    </div>
                    {{end}}
                </dl>
            </div>
        </details>
        {{end}}

        {{/* Response details - collapsible */}}
        {{with $.Result.Response}}
        <details class="mt-3">
            <summary style="cursor:pointer;
                           color:var(--color-text-secondary);
                           font-size:var(--font-size-sm);
                           font-weight:var(--font-weight-medium);
                           padding:var(--space-2) 0;
                           list-style:none;
                           display:flex;
                           align-items:center;
                           gap:var(--space-2)">
                <i data-lucide="chevron-right" class="w-3 h-3" style="transition:transform 0.2s"></i>
                Response Details
            </summary>
            <div style="margin-top:var(--space-2);
                       padding:var(--space-3);
                       background:var(--color-surface-secondary);
                       border-radius:var(--border-radius-md);
                       border:var(--border-width) solid var(--color-border)">
                <dl class="data-list data-list--stacked">
                    <div class="data-item">
                        <dt>Status Code</dt>
                        <dd><code>{{.StatusCode}}</code></dd>
                    </div>
                    {{if .Headers}}
                    <div class="data-item">
                        <dt>Headers</dt>
                        <dd>
                            <div class="mono small" style="display:flex;flex-direction:column;gap:var(--space-1)">
                                {{range $k, $v := .Headers}}
                                <div style="word-break:break-all;overflow-wrap:anywhere"><strong>{{$k}}:</strong> {{$v}}</div>
                                {{end}}
                            </div>
                        </dd>
                    </div>
                    {{end}}
                    {{if .Body}}
                    <div class="data-item">
                        <dt>Body{{if .BodyTruncated}} <span class="text-muted">(truncated)</span>{{end}}</dt>
                        <dd>
                            <pre class="code-block" style="max-height:300px;overflow:auto">{{.Body}}</pre>
                        </dd>
                    </div>
                    {{end}}
                </dl>
            </div>
        </details>
        {{end}}
    </div>
    {{else}}
    <div class="card-body">
        <p class="text-muted">No test result available.</p>
    </div>
    {{end}}
</div>
{{end}}
